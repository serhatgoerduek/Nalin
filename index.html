<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nalin üíò</title>

  <style>
    :root{
      --bg1:#ff6b81;
      --bg2:#ff9ff3;
      --glass: rgba(255,255,255,.16);
      --border: rgba(255,255,255,.22);
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:#fff;
      text-align:center;
      background:
        radial-gradient(900px 700px at 20% 10%, rgba(255,255,255,.18), transparent 60%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
      overflow:hidden;
    }

    /* Overlay, das sicher √ºber dem Viewport liegt */
    .overlay{
      position:fixed;
      inset:0;
      display:grid;
      place-items:center;
      padding:18px;
      pointer-events:none; /* nur Button bekommt pointer events */
    }

    .card{
      width:min(560px, 100%);
      background:var(--glass);
      border:1px solid var(--border);
      backdrop-filter: blur(18px);
      border-radius:26px;
      box-shadow:0 25px 60px rgba(0,0,0,.30);
      padding:34px 22px 22px;
      pointer-events:auto;
      position:relative;
      z-index:2;
    }

    h1{ margin:0 0 10px; font-size:28px; }
    p{ margin:0 0 8px; opacity:.92; }
    h2{ margin:10px 0 0; font-size:20px; font-weight:900; }

    .btnRow{
      margin-top:18px;
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
    }

    button{
      border:0;
      border-radius:14px;
      padding:12px 22px;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, filter .12s ease, left .10s ease, top .10s ease;
    }
    button:active{ transform: translateY(1px) scale(.99); }

    .yes{
      background:#fff;
      color:#ff2d55;
      box-shadow:0 16px 30px rgba(0,0,0,.18);
    }
    .yes:hover{ transform: scale(1.03); filter:brightness(1.03); }

    /* ‚úÖ Nein Button: absolut im Overlay, immer anklickbar */
    .no{
      position:fixed; /* bleibt am sichtbaren Viewport */
      left:16px;
      top:16px;
      z-index:9999;
      pointer-events:auto;

      background:rgba(255,255,255,.28);
      color:#fff;
      border:1px solid rgba(255,255,255,.22);
    }
    .no:hover{ transform:none; filter:none; }

    .result{
      display:none;
      margin-top:18px;
      font-size:18px;
      line-height:1.35;
      padding:14px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.10);
    }

    .spotify{
      display:none;
      margin-top:14px;
    }
    iframe{
      width:100%;
      height:152px;
      border:0;
      border-radius:16px;
    }

    .heart{
      position:fixed;
      bottom:-20px;
      font-size:22px;
      animation:floatUp 4s linear forwards;
      pointer-events:none;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.25));
      z-index:9998;
    }
    @keyframes floatUp{
      to{ transform:translateY(-110vh); opacity:0; }
    }
  </style>
</head>

<body>
  <div class="overlay" id="overlay">
    <main class="card" id="card">
      <h1>Nalin‚Ä¶ üíò</h1>
      <p>Ich mach‚Äôs kurz und ehrlich üòå</p>
      <h2>Willst du mein Valentine sein? üåπ</h2>

      <div class="btnRow">
        <button class="yes" id="yesBtn">Ja üíñ</button>
      </div>

      <div class="result" id="result">
        Yesss üòç Dann ist das unser Song ‚ú®üåπ
      </div>

      <div class="spotify" id="spotify">
        <iframe
          id="spotifyFrame"
          src=""
          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
        </iframe>
      </div>
    </main>
  </div>

  <button class="no" id="noBtn">Nein üôà</button>

<script>
  const card = document.getElementById("card");
  const noBtn = document.getElementById("noBtn");
  const yesBtn = document.getElementById("yesBtn");
  const result = document.getElementById("result");
  const spotify = document.getElementById("spotify");
  const spotifyFrame = document.getElementById("spotifyFrame");

  // Radius um die Card (px)
  const RADIUS_MIN = 90;
  const RADIUS_MAX = 220;
  const EDGE_PAD   = 16;

  function rand(min, max){ return Math.random()*(max-min)+min; }
  function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

  // ‚úÖ iPhone-safe Viewport Ma√üe
  function viewportBox(){
    const vv = window.visualViewport;
    const w = vv?.width  ?? document.documentElement.clientWidth;
    const h = vv?.height ?? document.documentElement.clientHeight;
    // visuelle Viewport-Offsets (Safari kann scroll/zoom offsets haben)
    const ox = vv?.offsetLeft ?? 0;
    const oy = vv?.offsetTop  ?? 0;
    return { w, h, ox, oy };
  }

  function btnSize(){
    const r = noBtn.getBoundingClientRect();
    return { w: r.width || 110, h: r.height || 48 };
  }

  function jumpNo(){
    const cr = card.getBoundingClientRect();
    const cx = cr.left + cr.width/2;
    const cy = cr.top  + cr.height/2;

    const { w:bw, h:bh } = btnSize();
    const { w:vw, h:vh, ox, oy } = viewportBox();

    const angle  = rand(0, Math.PI*2);
    const radius = rand(RADIUS_MIN, RADIUS_MAX);

    let x = cx + Math.cos(angle)*radius - bw/2;
    let y = cy + Math.sin(angle)*radius - bh/2;

    // clamp in visual viewport (mit offsets)
    const minX = ox + EDGE_PAD;
    const maxX = ox + vw - bw - EDGE_PAD;
    const minY = oy + EDGE_PAD;
    const maxY = oy + vh - bh - EDGE_PAD;

    x = clamp(x, minX, maxX);
    y = clamp(y, minY, maxY);

    noBtn.style.left = x + "px";
    noBtn.style.top  = y + "px";
  }

  // ‚úÖ Initialisierung mehrfach (Safari/iOS Layout Updates)
  function initNo(){
    jumpNo();
    setTimeout(jumpNo, 50);
    setTimeout(jumpNo, 200);
  }

  // Wenn DOM fertig ist
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initNo);
  } else {
    initNo();
  }

  // Bei Viewport-√Ñnderungen (iPhone Adressleiste etc.)
  window.addEventListener("resize", ()=>{ if(!noBtn.disabled) jumpNo(); });
  window.addEventListener("scroll", ()=>{ if(!noBtn.disabled) jumpNo(); }, {passive:true});
  window.visualViewport?.addEventListener("resize", ()=>{ if(!noBtn.disabled) jumpNo(); });
  window.visualViewport?.addEventListener("scroll", ()=>{ if(!noBtn.disabled) jumpNo(); });

  noBtn.addEventListener("click", (e)=>{ e.preventDefault(); jumpNo(); });
  noBtn.addEventListener("touchstart", (e)=>{ e.preventDefault(); jumpNo(); }, {passive:false});

  yesBtn.addEventListener("click", ()=>{
    result.style.display = "block";
    spotify.style.display = "block";
    yesBtn.disabled = true;
    yesBtn.textContent = "Ja (fest!) üíñ";
    noBtn.disabled = true;

    for(let i=0;i<26;i++){
      const h=document.createElement("div");
      h.className="heart";
      h.textContent="üíñ";
      h.style.left=(Math.random()*100)+"vw";
      h.style.animationDuration=(3+Math.random()*2)+"s";
      document.body.appendChild(h);
      setTimeout(()=>h.remove(), 4000);
    }

    spotifyFrame.src = "https://open.spotify.com/embed/track/3U5JVgI2x4rDyHGObzJfNf?utm_source=generator&autoplay=1";
  });
</script>
</body>
</html>
